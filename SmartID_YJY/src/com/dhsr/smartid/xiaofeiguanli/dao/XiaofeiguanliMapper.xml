<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dhsr.smartid.xiaofeiguanli.dao.XiaofeiguanliMapper">
	<sql id="MerchantSql">MerchantInnerId,MerchantId,MerchantName,AppInnerId,AreaInnerId,MerchantType,DelFlag,Remark,StandbyA,StandbyB,Proportion</sql>
	<sql id="MerchantSqlNoId">MerchantId,MerchantName,AppInnerId,AreaInnerId,MerchantType,DelFlag,Remark,StandbyA,StandbyB,Proportion</sql>
	<sql id="ConTypeSql">ConTypeInnerId,ConTypeId,ConTypeName,Remark,DelFlag,StandbyA,StandbyB,BeginTime,EndTime</sql>
	<sql id="ConTypeSqlNoId">ConTypeId,ConTypeName,Remark,DelFlag,StandbyA,StandbyB,BeginTime,EndTime</sql>
	<sql id="ConTerminalSql">ConTerminalInnerId,ConTerminalId,ConTerminalName,MerchantInnerId,AppInnerId,AreaInnerId,TerminalTypeInnerId,ComId,ComSerials,ConTypeList,DelFlag,Remark,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="ConTerminalSqlNoId">ConTerminalId,ConTerminalName,MerchantInnerId,AppInnerId,AreaInnerId,TerminalTypeInnerId,ComId,ComSerials,ConTypeList,DelFlag,Remark,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="ConLogSqlNoId">MarkInnerId,MarkId,MarkTypeInnerId,UserInnerId,DepartmentInnerId,CompanyInnerId,ConTerminalInnerId,TerminalTypeInnerId,MerchantInnerId,AppInnerId,AreaInnerId,PersonMoney,AllowanceMoney,NumberMoney,PersonBFMoney,PersonAFMoney,AllowanceBFMoney,AllowanceAFMoney,NumberBFMoney,NumberAFMoney,Money1,Money2,Money,DiscountMoney,Proportion,ConDatetime,UploadDatetime,ConTypeInnerId,ConPattern,ConWay,LimitTimes,OffLine,ErrorConLogInnerId,Operator,Remark,StandbyA,StandbyB,StandbyC,StandbyD,Rules</sql>
	<sql id="ConLogSql">ConLogInnerId,MarkInnerId,MarkId,MarkTypeInnerId,UserInnerId,DepartmentInnerId,CompanyInnerId,ConTerminalInnerId,TerminalTypeInnerId,MerchantInnerId,AppInnerId,AreaInnerId,PersonMoney,AllowanceMoney,NumberMoney,PersonBFMoney,PersonAFMoney,AllowanceBFMoney,AllowanceAFMoney,NumberBFMoney,NumberAFMoney,Money1,Money2,Money,DiscountMoney,Proportion,ConDatetime,UploadDatetime,ConTypeInnerId,ConPattern,ConWay,LimitTimes,OffLine,ErrorConLogInnerId,Operator,Remark,StandbyA,StandbyB,StandbyC,StandbyD,Rules</sql>
	<sql id="ConLogUserSql">ConLogInnerId,MarkInnerId,MarkId,MarkTypeInnerId,UserInnerId,DepartmentInnerId,CompanyInnerId,ConTerminalInnerId,TerminalTypeInnerId,MerchantInnerId,AppInnerId,AreaInnerId,PersonMoney,AllowanceMoney,NumberMoney,PersonBFMoney,PersonAFMoney,AllowanceBFMoney,AllowanceAFMoney,NumberBFMoney,NumberAFMoney,Money1,Money2,Money,DiscountMoney,Proportion,ConDatetime,UploadDatetime,ConTypeInnerId,ConPattern,ConWay,LimitTimes,OffLine,ErrorConLogInnerId,Operator,Remark,StandbyA,StandbyB,StandbyC,StandbyD,MarkName,MarkTypeId,MarkTypeName,UserId,UserName,DepartmentId,DepartmentName,CompanyId,CompanyName,ConTerminalId,ConTerminalName,TerminalTypeId,TerminalTypeName,MerchantId,MerchantName,AppId,AppName,AreaId,AreaName,ConTypeId,ConTypeName,Rules</sql>
	<sql id="Con_OperatorPerSql">OperatorInnerId,OperatorId,OperatorName,MerchantList,ConTerminalList,Remark,StandbyA,StandbyB</sql>
	<sql id="OperatorPerSqlNoId">OperatorInnerId,MerchantList,ConTerminalList,Remark,StandbyA,StandbyB</sql>
	<sql id="MerchantDiscountSql">MerchantDiscountInnerId,MerchantDiscountId,MerchantDiscountName,MerchantInnerId,Proportion,UserTypeList,BeginTime,EndTime,Remark,DelFlag,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="MerchantDiscountSqlNoId">MerchantDiscountId,MerchantDiscountName,MerchantInnerId,Proportion,UserTypeList,BeginTime,EndTime,Remark,DelFlag,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="ConDiscountSql">ConDiscountInnerId,ConDiscountId,ConDiscountName,Proportion1,Money1,Proportion2,Money2,Proportion3,Money3,Proportion4,Money4,Proportion5,Money5,UserTypeList,Remark,DelFlag,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="ConDiscountSqlNoId">ConDiscountId,ConDiscountName,Proportion1,Money1,Proportion2,Money2,Proportion3,Money3,Proportion4,Money4,Proportion5,Money5,UserTypeList,Remark,DelFlag,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="TimeRuleSql">TimeRuleInnerId,TimeRuleId,TimeRuleName,MerchantInnerId,Minutes,Money,Intpart,Timeout,MinMoney,Freetime,DelFlag,Remark,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="TimeRuleSqlNoId">TimeRuleId,TimeRuleName,MerchantInnerId,Minutes,Money,Intpart,Timeout,MinMoney,Freetime,DelFlag,Remark,StandbyA,StandbyB,StandbyC,StandbyD</sql>
	<sql id="MenuTypeSql">FMenuTypeInnerId,FMenuTypeId,FMenuTypeName,DelFlag,FRemark,FStandbyA,FStandbyB,FStandbyC,FStandbyD,FMerchantInnerId,FEnableFlag</sql>
	<sql id="MenuTypeSqlNoId">FMenuTypeId,FMenuTypeName,DelFlag,FRemark,FStandbyA,FStandbyB,FStandbyC,FStandbyD,FMerchantInnerId,FEnableFlag</sql>
	<sql id="MenuListSql">FMenuInnerId,FMenuTypeInnerId,FMenuPrice,FEnableFlag,DelFlag,FMenuId,FMenuName,FRemark,FStandbyA,FStandbyB,FStandbyC,FStandbyD</sql>
	<sql id="MenuListSqlNoId">FMenuTypeInnerId,FMenuPrice,FEnableFlag,DelFlag,FMenuId,FMenuName,FRemark,FStandbyA,FStandbyB,FStandbyC,FStandbyD</sql>
	<sql id="MealPriceSql">MealPriceInnerId,UserTypeList,MerchantList,BreakfastFirst,BreakfastNext,LunchFirst,LunchNext,DinnerFirst,DinnerNext,NightFirst,NightNext,DelFlag,Remark,StandbyA,StandbyB,StandbyC,StandbyD,BreakfastNums,LunchNums,DinnerNums,NightNums</sql>
	<sql id="MealPriceSqlNoId">UserTypeList,MerchantList,BreakfastFirst,BreakfastNext,LunchFirst,LunchNext,DinnerFirst,DinnerNext,NightFirst,NightNext,DelFlag,Remark,StandbyA,StandbyB,StandbyC,StandbyD,BreakfastNums,LunchNums,DinnerNums,NightNums</sql>
	<sql id="menusSql">FMenuInnerId,FMenuId,FMenuName,FMenuTypeInnerId,FConTypeInnerId,FMenuPrice,FMenuTypeName,FMerchantInnerId,FEnableFlag,DelFlag,EnableFlag,Del,MerchantName</sql>

	<!-- 根据主键查询商户 -->
	<select id="selectMerchantByInnerId" parameterType="Integer" resultType="Merchant">
		SELECT
		<include refid="MerchantSql" />
		FROM Consumption_Merchant
		where DelFlag=0 and MerchantInnerId = #{MerchantInnerId}
	</select>
	
	<!-- 根据主键查询商户 -->
	<select id="selectMerchantByOperatorInnerId" parameterType="Integer" resultType="String">
		SELECT MerchantList
		FROM Consumption_OperatorPer
		where OperatorInnerId = #{OperatorInnerId}
	</select>

	<!-- 查询商户 -->
	<select id="selectMerchant" parameterType="Map" resultType="Merchant">
		SELECT TOP ${rows}
		<include refid="MerchantSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="MerchantSql" />
		FROM Consumption_Merchant
		where DelFlag=0
		<if test="MerchantInnerId !=null">
			and MerchantInnerId = #{MerchantInnerId}
		</if>
		<if test="AppInnerId !=null">
			and AppInnerId = #{AppInnerId}
		</if>
		<if test="MerchantId !=null and MerchantId !='' ">
			and MerchantId like '%${MerchantId}%'
		</if>
		<if test="MerchantName !=null and MerchantName !='' ">
			and MerchantName like '%${MerchantName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 查询商户总数 -->
	<select id="selectMerchantTotal" parameterType="Map" resultType="Integer">
		SELECT count(MerchantInnerId) FROM Consumption_Merchant where DelFlag=0
		<if test="MerchantInnerId !=null">
			and MerchantInnerId = #{MerchantInnerId}
		</if>
		<if test="AppInnerId !=null">
			and AppInnerId = #{AppInnerId}
		</if>
		<if test="MerchantId !=null and MerchantId !='' ">
			and MerchantId like '%${MerchantId}%'
		</if>
		<if test="MerchantName !=null and MerchantName !='' ">
			and MerchantName like '%${MerchantName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
	</select>

	<!-- 新增商户 -->
	<insert id="insertMerchant" parameterType="Merchant" useGeneratedKeys="true" keyProperty="MerchantInnerId">
		INSERT INTO Consumption_Merchant
		(
		<include refid="MerchantSqlNoId" />
		)
		VALUES
		(#{MerchantId},#{MerchantName},#{AppInnerId},#{AreaInnerId},#{MerchantType},0,#{Remark},#{StandbyA},#{StandbyB},#{Proportion})
	</insert>

	<!-- 修改商户 -->
	<update id="updateMerchant" parameterType="Merchant">
		UPDATE Consumption_Merchant SET
		MerchantId = #{MerchantId},
		MerchantName = #{MerchantName},
		AppInnerId = #{AppInnerId},
		AreaInnerId = #{AreaInnerId},
		MerchantType = #{MerchantType},
		Proportion = #{Proportion},
		Remark = #{Remark},
		StandbyA = #{StandbyA},
		StandbyB = #{StandbyB}
		WHERE MerchantInnerId = #{MerchantInnerId}
	</update>

	<!-- 根据主键查询消费类型 -->
	<select id="selectConTypeByInnerId" parameterType="Integer" resultType="ConType">
		SELECT
		<include refid="ConTypeSql" />
		FROM Consumption_ConType
		where DelFlag=0 and ConTypeInnerId = #{ConTypeInnerId}
	</select>

	<!-- 查询消费类型 -->
	<select id="selectConType" parameterType="Map" resultType="ConType">
		SELECT TOP ${rows}
		<include refid="ConTypeSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="ConTypeSql" />
		FROM Consumption_ConType
		where DelFlag=0
		<if test="ConTypeId !=null and ConTypeId !='' ">
			and ConTypeId like '%${ConTypeId}%'
		</if>
		<if test="ConTypeName !=null and ConTypeName !='' ">
			and ConTypeName like '%${ConTypeName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 查询消费类型总数 -->
	<select id="selectConTypeTotal" parameterType="Map" resultType="Integer">
		SELECT count(ConTypeInnerId) FROM Consumption_ConType where DelFlag=0
		<if test="ConTypeId !=null and ConTypeId !='' ">
			and ConTypeId like '%${ConTypeId}%'
		</if>
		<if test="ConTypeName !=null and ConTypeName !='' ">
			and ConTypeName like '%${ConTypeName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
	</select>

	<!-- 新增消费类型 -->
	<insert id="insertConType" parameterType="ConType" useGeneratedKeys="true" keyProperty="ConTypeInnerId">
		INSERT INTO Consumption_ConType
		(
		<include refid="ConTypeSqlNoId" />
		)
		VALUES
		(#{ConTypeId},#{ConTypeName},#{Remark},0,#{StandbyA},#{StandbyB},#{BeginTime},#{EndTime})
	</insert>

	<!-- 修改消费类型 -->
	<update id="updateConType" parameterType="ConType">
		UPDATE Consumption_ConType SET
		ConTypeId = #{ConTypeId},
		ConTypeName = #{ConTypeName},
		BeginTime = #{BeginTime},
		EndTime = #{EndTime},
		Remark = #{Remark},
		StandbyA = #{StandbyA},
		StandbyB = #{StandbyB}
		WHERE ConTypeInnerId = #{ConTypeInnerId}
	</update>

	<!-- 根据主键查询消费设备 -->
	<select id="selectConTerminalByInnerId" parameterType="Integer" resultType="ConTerminal">
		SELECT
		<include refid="ConTerminalSql" />
		FROM Consumption_Terminal
		where DelFlag=0 and ConTerminalInnerId = #{ConTerminalInnerId}
	</select>

	<!-- 查询消费设备 -->
	<select id="selectConTerminal" parameterType="Map" resultType="ConTerminal">
		SELECT TOP ${rows}
		<include refid="ConTerminalSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="ConTerminalSql" />
		FROM Consumption_Terminal
		where DelFlag=0
		<if test="MerchantInnerId !=null and MerchantInnerId !='' ">
			and MerchantInnerId = #{MerchantInnerId}
		</if>
		<if test="ConTerminalId !=null and ConTerminalId !='' ">
			and ConTerminalId like '%${ConTerminalId}%'
		</if>
		<if test="ConTerminalName !=null and ConTerminalName !='' ">
			and ConTerminalName like '%${ConTerminalName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 查询消费设备总数 -->
	<select id="selectConTerminalTotal" parameterType="Map" resultType="Integer">
		SELECT count(ConTerminalInnerId) FROM Consumption_Terminal where DelFlag=0
		<if test="MerchantInnerId !=null and MerchantInnerId !='' ">
			and MerchantInnerId = #{MerchantInnerId}
		</if>
		<if test="ConTerminalId !=null and ConTerminalId !='' ">
			and ConTerminalId like '%${ConTerminalId}%'
		</if>
		<if test="ConTerminalName !=null and ConTerminalName !='' ">
			and ConTerminalName like '%${ConTerminalName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
	</select>

	<!-- 新增消费设备 -->
	<insert id="insertConTerminal" parameterType="ConTerminal" useGeneratedKeys="true" keyProperty="ConTerminalInnerId">
		INSERT INTO Consumption_Terminal
		(
		<include refid="ConTerminalSqlNoId" />
		)
		VALUES
		(#{ConTerminalId},#{ConTerminalName},#{MerchantInnerId},#{AppInnerId},#{AreaInnerId},#{TerminalTypeInnerId},#{ComId},#{ComSerials},#{ConTypeList},0,#{Remark},#{StandbyA},#{StandbyB},#{StandbyC},#{StandbyD})
	</insert>

	<!-- 修改消费设备 -->
	<update id="updateConTerminal" parameterType="ConTerminal">
		UPDATE Consumption_Terminal SET
		ConTerminalId = #{ConTerminalId},
		ConTerminalName = #{ConTerminalName},
		MerchantInnerId = #{MerchantInnerId},
		AppInnerId = #{AppInnerId},
		AreaInnerId = #{AreaInnerId},
		TerminalTypeInnerId = #{TerminalTypeInnerId},
		ComId = #{ComId},
		ComSerials = #{ComSerials},
		ConTypeList = #{ConTypeList},
		Remark = #{Remark},
		StandbyA = #{StandbyA},
		StandbyB = #{StandbyB},
		StandbyC = #{StandbyC},
		StandbyD = #{StandbyD}
		WHERE ConTerminalInnerId = #{ConTerminalInnerId}
	</update>

	<!-- 根据主键查询消费记录 -->
	<select id="selectConLogByInnerId" parameterType="Map" resultType="ConLog">
		SELECT top 1
		<include refid="ConLogSql" />
		FROM Consumption_Conlog_Discount
		where 1=1
		<if test="ConLogInnerId != null and ConLogInnerId != ''">
			and ConLogInnerId = #{ConLogInnerId}
		</if>
		<if test="ErrorConLogInnerId != null and ErrorConLogInnerId != ''">
			and ErrorConLogInnerId = #{ErrorConLogInnerId}
		</if>
	</select>

	<!-- 查询消费记录 -->
	<select id="selectConLog" parameterType="Map" resultType="ConLog_User">
		SELECT TOP ${rows}
		<include refid="ConLogUserSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}) AS RowNumber,
		<include refid="ConLogUserSql" />
		FROM ConLog_User
		where 1=1
		<if test="UserId !=null and UserId !='' ">
			and UserId like '%${UserId}%'
		</if>
		<if test="UserName !=null and UserName !='' ">
			and UserName like '%${UserName}%'
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
			and UploadDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
			and ConDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="DepartmentInnerId !=null and DepartmentInnerId !=''">
			and DepartmentInnerId in (select str2table from StrToTable(#{DepartmentInnerId}))
		</if>
		<if test="ConTerminalInnerId !=null and ConTerminalInnerId !=''">
			and ConTerminalInnerId in (select str2table from StrToTable(#{ConTerminalInnerId}))
		</if>
		<if test="MerchantList !=null and MerchantList !=''">
			and MerchantInnerId in (select str2table from StrToTable(#{MerchantList}))
		</if>
		<if test="ConTypeList !=null and ConTypeList !=''">
			and ConTypeInnerId in (select str2table from StrToTable(#{ConTypeList}))
		</if>
		<if test="ConWay !=null and ConWay !=''">
			and ConWay in (select str2table from StrToTable(#{ConWay}))
		</if>
		<if test="ConPattern !=null and ConPattern !=''">
			and ConPattern in (select str2table from StrToTable(#{ConPattern}))
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB in (select str2table from StrToTable(#{StandbyB}))
		</if>
		<if test="StandbyC !=null and StandbyC !='' ">
			and StandbyC like '%${StandbyC}%'
		</if>
		<if test="StandbyD !=null and StandbyD !='' ">
			and StandbyD like '%${StandbyD}%'
		</if>
		<if test="Flag != null and Flag == '1'">
			and UserTypeInnerId != -1
		</if>
		<if test="Flag != null and Flag == '2'">
			and UserTypeInnerId = -1
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 查询消费记录总数 -->
	<select id="selectConLogTotal" parameterType="Map" resultType="Long">
		SELECT count(ConLogInnerId) FROM ConLog_User where 1=1
		<if test="UserId !=null and UserId !='' ">
			and UserId like '%${UserId}%'
		</if>
		<if test="UserName !=null and UserName !='' ">
			and UserName like '%${UserName}%'
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
			and UploadDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
			and ConDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="DepartmentInnerId !=null and DepartmentInnerId !=''">
			and DepartmentInnerId in (select str2table from StrToTable(#{DepartmentInnerId}))
		</if>
		<if test="ConTerminalInnerId !=null and ConTerminalInnerId !=''">
			and ConTerminalInnerId in (select str2table from StrToTable(#{ConTerminalInnerId}))
		</if>
		<if test="MerchantList !=null and MerchantList !=''">
			and MerchantInnerId in (select str2table from StrToTable(#{MerchantList}))
		</if>
		<if test="ConTypeList !=null and ConTypeList !=''">
			and ConTypeInnerId in (select str2table from StrToTable(#{ConTypeList}))
		</if>
		<if test="ConWay !=null and ConWay !=''">
			and ConWay in (select str2table from StrToTable(#{ConWay}))
		</if>
		<if test="ConPattern !=null and ConPattern !=''">
			and ConPattern in (select str2table from StrToTable(#{ConPattern}))
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB in (select str2table from StrToTable(#{StandbyB}))
		</if>
		<if test="StandbyC !=null and StandbyC !='' ">
			and StandbyC like '%${StandbyC}%'
		</if>
		<if test="StandbyD !=null and StandbyD !='' ">
			and StandbyD like '%${StandbyD}%'
		</if>
		<if test="Flag == '1'">
			and UserTypeInnerId != -1
		</if>
		<if test="Flag == '2'">
			and UserTypeInnerId = -1
		</if>
	</select>

	<!-- 查询未处理的消费记录 -->
	<select id="selectConLogUntreated" resultType="ConLog">
		SELECT *
		FROM Consumption_ConLog_Discount
		where StandbyD = '1'
	</select>

	<!-- 修改消费记录 -->
	<update id="updateConLog" parameterType="ConLog">
		UPDATE Consumption_ConLog_Discount SET
		StandbyD = #{StandbyD}
		WHERE ConLogInnerId = #{ConLogInnerId}
	</update>

	<!-- 新增消费记录（误消费补款） -->
	<insert id="insertConLog" parameterType="ConLog">
		INSERT INTO Consumption_Conlog_Discount
		(
		<include refid="ConLogSqlNoId" />
		)
		VALUES
		(#{MarkInnerId},#{MarkId},#{MarkTypeInnerId},#{UserInnerId},#{DepartmentInnerId},#{CompanyInnerId},#{ConTerminalInnerId},#{TerminalTypeInnerId},#{MerchantInnerId},#{AppInnerId},#{AreaInnerId},#{PersonMoney},#{AllowanceMoney},#{NumberMoney},#{PersonBFMoney},#{PersonAFMoney},#{AllowanceBFMoney},#{AllowanceAFMoney},#{NumberBFMoney},#{NumberAFMoney},#{Money1},#{Money2},#{Money},#{DiscountMoney},#{Proportion},#{ConDatetime},#{UploadDatetime},#{ConTypeInnerId},#{ConPattern},#{ConWay},#{LimitTimes},#{OffLine},#{ErrorConLogInnerId},#{Operator},#{Remark},#{StandbyA},#{StandbyB},#{StandbyC},#{StandbyD},#{Rules})
	</insert>


	<!-- 消费统计 -->
	<select id="selectConStatistics" parameterType="Map" resultType="ConStatistics">
		SELECT
		<if test="Type !=null and Type !='' and Type == 'sum'">
			sum(PersonMoney) as PersonMoney,sum(AllowanceMoney) as AllowanceMoney,sum(NumberMoney) as NumberMoney,sum(Money) as Money,sum(DiscountMoney) as DiscountMoney,sum(Proportion) as Proportion,
		</if>
		<if test="Type !=null and Type !='' and Type == 'count'">
			count(ConLogInnerId) as DiscountMoney,0 as AllowanceMoney,0 as PersonMoney,0 as NumberMoney,0 as Money,0 as Proportion,
		</if>
		MerchantInnerId,AppInnerId,AreaInnerId
		<if test="RowName !=null and RowName !='' and RowName == 'ConTypeInnerId'">
			,ConTypeInnerId as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConWay'">
			,ConWay as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConPattern'">
			,ConPattern as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'OffLine'">
			,OffLine as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Year'">
			,convert(nvarchar(4),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120) as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Month'">
			,convert(nvarchar(7),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120) as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Day'">
			,convert(nvarchar(10),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120) as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'CompanyInnerId'">
			,DepartmentInnerId as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'LimitTimes'">
			,LimitTimes as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ErrorConLog'">
			,isnull(nullif(0,ErrorConLogInnerId),'1') as RowName
		</if>
		FROM Consumption_Conlog_Discount where DepartmentInnerId != 42
		<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
			and UploadDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
			and ConDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="UserId !='' or UserName !=''">
			and UserInnerId in (SELECT UserInnerId FROM System_UserInfo where UserId like '%${UserId}%' and UserName like '%${UserName}%')
		</if>
		<if test="DepartmentInnerId !=null and DepartmentInnerId !=''">
			and DepartmentInnerId in (select str2table from StrToTable(#{DepartmentInnerId}))
		</if>
		<if test="MerchantList !=null and MerchantList !=''">
			and MerchantInnerId in (select str2table from StrToTable(#{MerchantList}))
		</if>
		<if test="ConTypeList !=null and ConTypeList !=''">
			and ConTypeInnerId in (select str2table from StrToTable(#{ConTypeList}))
		</if>
		<if test="ConWay !=null and ConWay !=''">
			and ConWay in (select str2table from StrToTable(#{ConWay}))
		</if>
		<if test="ConPattern !=null and ConPattern !=''">
			and ConPattern in (select str2table from StrToTable(#{ConPattern}))
		</if>
		group by
		<if test="RowName !=null and RowName !='' and RowName == 'ConTypeInnerId'">
			ConTypeInnerId,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConWay'">
			ConWay,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConPattern'">
			ConPattern,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'OffLine'">
			OffLine,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Year'">
			convert(nvarchar(4),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120),
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Month'">
			convert(nvarchar(7),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120),
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Day'">
			convert(nvarchar(10),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120),
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'CompanyInnerId'">
			DepartmentInnerId,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'LimitTimes'">
			LimitTimes,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ErrorConLog'">
			isnull(nullif(0,ErrorConLogInnerId),'1'),
		</if>
		AreaInnerId,AppInnerId,MerchantInnerId
		<if test="RowName !=null and RowName !='' and RowName == 'ConTypeInnerId'">
			order by ConTypeInnerId
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConWay'">
			order by ConWay
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConPattern'">
			order by ConPattern
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'OffLine'">
			order by OffLine
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Year'">
			order by convert(nvarchar(4),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120)
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Month'">
			order by convert(nvarchar(7),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120)
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Day'">
			order by convert(nvarchar(10),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120)
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'CompanyInnerId'">
			order by DepartmentInnerId
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'LimitTimes'">
			order by LimitTimes
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ErrorConLog'">
			order by isnull(nullif(0,ErrorConLogInnerId),'1')
		</if>
	</select>
	
	
	<!-- 临时卡消费统计 -->
	<select id="selectLSConStatistics" parameterType="Map" resultType="ConStatistics">
		SELECT
		<if test="Type !=null and Type !='' and Type == 'sum'">
			sum(PersonMoney) as PersonMoney,sum(AllowanceMoney) as AllowanceMoney,sum(NumberMoney) as NumberMoney,sum(Money) as Money,sum(DiscountMoney) as DiscountMoney,sum(Proportion) as Proportion,
		</if>
		<if test="Type !=null and Type !='' and Type == 'count'">
			count(ConLogInnerId) as DiscountMoney,0 as AllowanceMoney,0 as PersonMoney,0 as NumberMoney,0 as Money,0 as Proportion,
		</if>
		MerchantInnerId,AppInnerId,AreaInnerId
		<if test="RowName !=null and RowName !='' and RowName == 'ConTypeInnerId'">
			,ConTypeInnerId as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConWay'">
			,ConWay as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConPattern'">
			,ConPattern as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'OffLine'">
			,OffLine as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Year'">
			,convert(nvarchar(4),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120) as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Month'">
			,convert(nvarchar(7),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120) as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Day'">
			,convert(nvarchar(10),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120) as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'LimitTimes'">
			,LimitTimes as RowName
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ErrorConLog'">
			,isnull(nullif(0,ErrorConLogInnerId),'1') as RowName
		</if>
		FROM Consumption_Conlog_Discount where DepartmentInnerId = 42
		<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
			and UploadDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
			and ConDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="MerchantList !=null and MerchantList !=''">
			and MerchantInnerId in (select str2table from StrToTable(#{MerchantList}))
		</if>
		<if test="ConTypeList !=null and ConTypeList !=''">
			and ConTypeInnerId in (select str2table from StrToTable(#{ConTypeList}))
		</if>
		<if test="ConWay !=null and ConWay !=''">
			and ConWay in (select str2table from StrToTable(#{ConWay}))
		</if>
		<if test="ConPattern !=null and ConPattern !=''">
			and ConPattern in (select str2table from StrToTable(#{ConPattern}))
		</if>
		group by
		<if test="RowName !=null and RowName !='' and RowName == 'ConTypeInnerId'">
			ConTypeInnerId,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConWay'">
			ConWay,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConPattern'">
			ConPattern,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'OffLine'">
			OffLine,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Year'">
			convert(nvarchar(4),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120),
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Month'">
			convert(nvarchar(7),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120),
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Day'">
			convert(nvarchar(10),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120),
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'LimitTimes'">
			LimitTimes,
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ErrorConLog'">
			isnull(nullif(0,ErrorConLogInnerId),'1'),
		</if>
		AreaInnerId,AppInnerId,MerchantInnerId
		<if test="RowName !=null and RowName !='' and RowName == 'ConTypeInnerId'">
			order by ConTypeInnerId
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConWay'">
			order by ConWay
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ConPattern'">
			order by ConPattern
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'OffLine'">
			order by OffLine
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Year'">
			order by convert(nvarchar(4),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120)
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Month'">
			order by convert(nvarchar(7),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120)
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'Day'">
			order by convert(nvarchar(10),
			<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
				UploadDatetime
			</if>
			<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
				ConDatetime
			</if>
			,120)
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'CompanyInnerId'">
			order by DepartmentInnerId
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'LimitTimes'">
			order by LimitTimes
		</if>
		<if test="RowName !=null and RowName !='' and RowName == 'ErrorConLog'">
			order by isnull(nullif(0,ErrorConLogInnerId),'1')
		</if>
	</select>

	<!-- 根据主键查询操作员权限 -->
	<select id="selectConOperatorPerByInnerId" parameterType="Integer" resultType="Con_OperatorPer">
		SELECT
		<include refid="Con_OperatorPerSql" />
		FROM Con_OperatorPer
		where OperatorInnerId = #{OperatorInnerId}
	</select>

	<!-- 查询本月消费 -->
	<select id="selectConStatisticsMonth" parameterType="Integer" resultType="Integer">
		SELECT
		sum(DiscountMoney)
		FROM Consumption_Conlog_Discount
		where UserInnerId = #{UserInnerId} and datediff(month,UploadDatetime,getdate())=0
	</select>

	<!-- 查询操作员权限 -->
	<select id="selectConOperatorPer" parameterType="Map" resultType="Con_OperatorPer">
		SELECT TOP ${rows}
		<include refid="Con_OperatorPerSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="Con_OperatorPerSql" />
		FROM Con_OperatorPer
		where 1=1
		<if test="OperatorId !=null and OperatorId !='' ">
			and OperatorId like '%${OperatorId}%'
		</if>
		<if test="OperatorName !=null and OperatorName !='' ">
			and OperatorName like '%${OperatorName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 查询操作员权限总数 -->
	<select id="selectConOperatorPerTotal" parameterType="Map" resultType="Integer">
		SELECT count(OperatorInnerId) FROM Con_OperatorPer
		where 1=1
		<if test="OperatorId !=null and OperatorId !='' ">
			and OperatorId like '%${OperatorId}%'
		</if>
		<if test="OperatorName !=null and OperatorName !='' ">
			and OperatorName like '%${OperatorName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
	</select>

	<!-- 新增操作员权限 -->
	<insert id="insertConOperatorPer" parameterType="ConOperatorPer">
		INSERT INTO Consumption_OperatorPer
		(
		<include refid="OperatorPerSqlNoId" />
		)
		VALUES
		(#{OperatorInnerId},#{MerchantList},#{ConTerminalList},#{Remark},#{StandbyA},#{StandbyB})
	</insert>

	<!-- 修改操作员权限 -->
	<update id="updateConOperatorPer" parameterType="ConOperatorPer">
		UPDATE Consumption_OperatorPer SET
		MerchantList = #{MerchantList}
		WHERE OperatorInnerId = #{OperatorInnerId}
	</update>

	<!-- 通过主键查询商户优惠 -->
	<select id="selectMerchantDiscountByInnerId" parameterType="Integer" resultType="MerchantDiscount">
		SELECT
		<include refid="MerchantDiscountSql" />
		FROM Consumption_MerchantDiscount
		where DelFlag=0 and MerchantDiscountInnerId = #{MerchantDiscountInnerId}
	</select>

	<!-- 查询商户优惠 -->
	<select id="selectMerchantDiscount" parameterType="Map" resultType="MerchantDiscount">
		SELECT TOP ${rows}
		<include refid="MerchantDiscountSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="MerchantDiscountSql" />
		FROM Consumption_MerchantDiscount
		where DelFlag=0
		<if test="UserTypeInnerId !=null and UserTypeInnerId !=''">
			and #{UserTypeInnerId} in (select str2table from StrToTable(UserTypeList)) and getdate()> BeginTime
		</if>
		<if test="MerchantDiscountId !=null and MerchantDiscountId !='' ">
			and MerchantDiscountId like '%${MerchantDiscountId}%'
		</if>
		<if test="MerchantDiscountName !=null and MerchantDiscountName !='' ">
			and MerchantDiscountName like '%${MerchantDiscountName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		<if test="StandbyC !=null and StandbyC !='' ">
			and StandbyC like '%${StandbyC}%'
		</if>
		<if test="StandbyD !=null and StandbyD !='' ">
			and StandbyD like '%${StandbyD}%'
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>
	
	<!-- 查询商户优惠 -->
	<select id="selectAllUseConDiscount" resultType="MerchantDiscount">
		SELECT 
		<include refid="MerchantDiscountSql" />
		FROM Consumption_MerchantDiscount
		where DelFlag=0 and EndTime > getDate()
	</select>

	<!-- 查询未处理场地商户优惠 -->
	<select id="selectMerchantDiscountUntreated" parameterType="String" resultType="MerchantDiscount">
		SELECT
		<include refid="MerchantDiscountSql" />
		FROM Consumption_MerchantDiscount
		where StandbyD = #{StandbyD} 
	</select>

	<!-- 查询商户优惠总数 -->
	<select id="selectMerchantDiscountTotal" parameterType="Map" resultType="Integer">
		SELECT count(MerchantDiscountInnerId) FROM Consumption_MerchantDiscount where DelFlag=0
		<if test="UserTypeInnerId !=null and UserTypeInnerId !=''">
			and #{UserTypeInnerId} in (select str2table from StrToTable(UserTypeList))
		</if>
		<if test="MerchantDiscountId !=null and MerchantDiscountId !='' ">
			and MerchantDiscountId like '%${MerchantDiscountId}%'
		</if>
		<if test="MerchantDiscountName !=null and MerchantDiscountName !='' ">
			and MerchantDiscountName like '%${MerchantDiscountName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		<if test="StandbyC !=null and StandbyC !='' ">
			and StandbyC like '%${StandbyC}%'
		</if>
		<if test="StandbyD !=null and StandbyD !='' ">
			and StandbyD like '%${StandbyD}%'
		</if>
	</select>

	<!-- 新增商户优惠 -->
	<insert id="insertMerchantDiscount" parameterType="MerchantDiscount">
		INSERT INTO Consumption_MerchantDiscount
		(
		<include refid="MerchantDiscountSqlNoId" />
		)
		VALUES
		(#{MerchantDiscountId},#{MerchantDiscountName},#{MerchantInnerId},#{Proportion},#{UserTypeList},#{BeginTime},#{EndTime},#{Remark},0,#{StandbyA},#{StandbyB},#{StandbyC},#{StandbyD})
	</insert>

	<!-- 删除商户优惠 -->
	<update id="deleteMerchantDiscount" parameterType="MerchantDiscount">
		UPDATE Consumption_MerchantDiscount SET
		DelFlag = 1,
		StandbyD = '1'
		WHERE MerchantDiscountInnerId = #{MerchantDiscountInnerId}
	</update>

	<!-- 修改商户优惠 -->
	<update id="updateMerchantDiscount" parameterType="MerchantDiscount">
		UPDATE Consumption_MerchantDiscount SET
		MerchantDiscountId = #{MerchantDiscountId},
		MerchantDiscountName = #{MerchantDiscountName},
		MerchantInnerId = #{MerchantInnerId},
		Proportion = #{Proportion},
		UserTypeList = #{UserTypeList},
		BeginTime = #{BeginTime},
		EndTime = #{EndTime},
		Remark = #{Remark},
		StandbyA = #{StandbyA},
		StandbyB = #{StandbyB},
		StandbyC = #{StandbyC},
		StandbyD = #{StandbyD}
		WHERE MerchantDiscountInnerId = #{MerchantDiscountInnerId}
	</update>

	<!-- 通过主键查询积分优惠 -->
	<select id="selectConDiscountByInnerId" parameterType="Integer" resultType="ConDiscount">
		SELECT
		<include refid="ConDiscountSql" />
		FROM Consumption_ConDiscount
		where DelFlag=0 and ConDiscountInnerId = #{ConDiscountInnerId}
	</select>

	<!-- 查询积分优惠 -->
	<select id="selectConDiscount" parameterType="Map" resultType="ConDiscount">
		SELECT TOP ${rows}
		<include refid="ConDiscountSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="ConDiscountSql" />
		FROM Consumption_ConDiscount
		where DelFlag=0
		<if test="UserTypeInnerId !=null and UserTypeInnerId !=''">
			and #{UserTypeInnerId} in (select str2table from StrToTable(UserTypeList))
		</if>
		<if test="TimeAnd !=null">
			and (EndTime>#{BeginTime} and #{EndTime}>BeginTime)
		</if>
		<if test="ConDiscountId !=null and ConDiscountId !='' ">
			and ConDiscountId like '%${ConDiscountId}%'
		</if>
		<if test="ConDiscountName !=null and ConDiscountName !='' ">
			and ConDiscountName like '%${ConDiscountName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		<if test="StandbyC !=null and StandbyC !='' ">
			and StandbyC like '%${StandbyC}%'
		</if>
		<if test="StandbyD !=null and StandbyD !='' ">
			and StandbyD like '%${StandbyD}%'
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 查询未处理场地积分优惠 -->
	<select id="selectConDiscountUntreated" resultType="ConDiscount">
		SELECT
		<include refid="ConDiscountSql" />
		FROM Consumption_ConDiscount
		where StandbyD = '1'
	</select>

	<!-- 查询积分优惠总数 -->
	<select id="selectConDiscountTotal" parameterType="Map" resultType="Integer">
		SELECT count(ConDiscountInnerId) FROM Consumption_ConDiscount where DelFlag=0
		<if test="UserTypeInnerId !=null and UserTypeInnerId !=''">
			and #{UserTypeInnerId} in (select str2table from StrToTable(UserTypeList))
		</if>
		<if test="TimeAnd !=null">
			and (EndTime>#{BeginTime} and #{EndTime}>BeginTime)
		</if>
		<if test="ConDiscountId !=null and ConDiscountId !='' ">
			and ConDiscountId like '%${ConDiscountId}%'
		</if>
		<if test="ConDiscountName !=null and ConDiscountName !='' ">
			and ConDiscountName like '%${ConDiscountName}%'
		</if>
		<if test="Remark !=null and Remark !='' ">
			and Remark like '%${Remark}%'
		</if>
		<if test="StandbyA !=null and StandbyA !='' ">
			and StandbyA like '%${StandbyA}%'
		</if>
		<if test="StandbyB !=null and StandbyB !='' ">
			and StandbyB like '%${StandbyB}%'
		</if>
		<if test="StandbyC !=null and StandbyC !='' ">
			and StandbyC like '%${StandbyC}%'
		</if>
		<if test="StandbyD !=null and StandbyD !='' ">
			and StandbyD like '%${StandbyD}%'
		</if>
	</select>

	<!-- 新增积分优惠 -->
	<insert id="insertConDiscount" parameterType="ConDiscount">
		INSERT INTO Consumption_ConDiscount
		(
		<include refid="ConDiscountSqlNoId" />
		)
		VALUES
		(#{ConDiscountId},#{ConDiscountName},#{Proportion1},#{Money1},#{Proportion2},#{Money2},#{Proportion3},#{Money3},#{Proportion4},#{Money4},#{Proportion5},#{Money5},#{UserTypeList},#{Remark},0,#{StandbyA},#{StandbyB},#{StandbyC},#{StandbyD})
	</insert>

	<!-- 修改积分优惠 -->
	<update id="updateConDiscount" parameterType="ConDiscount">
		UPDATE Consumption_ConDiscount SET
		StandbyD = #{StandbyD}
		WHERE ConDiscountInnerId = #{ConDiscountInnerId}
	</update>

	<!-- 删除积分优惠 -->
	<update id="deleteConDiscount" parameterType="ConDiscount">
		UPDATE Consumption_ConDiscount SET
		DelFlag = 1,
		StandbyD = '1'
		WHERE ConDiscountInnerId = #{ConDiscountInnerId}
	</update>

	<select id="selectDiscountConsumptionByUser" resultType="DiscountConsumption" parameterType="Map">
		SELECT
		*
		FROM Discount_Consumption
		WHERE UserInnerId = #{UserInnerId} and MerchantInnerId = #{MerchantInnerId}
	</select>

	<insert id="insertDiscountConsumption" parameterType="DiscountConsumption">
		INSERT INTO Discount_Consumption
		(UserInnerId,MerchantInnerId,Proportion,StandbyC,StandbyD)
		VALUES
		(#{UserInnerId},#{MerchantInnerId},#{Proportion},#{StandbyC},#{StandbyD})
	</insert>

	<update id="updateDiscountConsumption" parameterType="DiscountConsumption">
		UPDATE Discount_Consumption SET
		Proportion = #{Proportion},
		StandbyC = #{StandbyC},
		StandbyD = #{StandbyD}
		WHERE UserInnerId = #{UserInnerId} and MerchantInnerId = #{MerchantInnerId}
	</update>

	<!-- 根据商户主键查询计时消费 -->
	<select id="selectTimeRuleByMerchantInnerId" parameterType="Integer" resultType="TimeRule">
		SELECT
		<include refid="TimeRuleSql" />
		FROM Consumption_TimeRule
		where DelFlag=0 and MerchantInnerId = #{MerchantInnerId}
	</select>

	<!-- 查询计时消费 -->
	<select id="selectTimeRule" parameterType="Map" resultType="TimeRule">
		SELECT TOP ${rows}
		<include refid="TimeRuleSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="TimeRuleSql" />
		FROM Consumption_TimeRule
		where DelFlag=0
		<if test="TimeRuleInnerId !=null">
			and TimeRuleInnerId = #{TimeRuleInnerId}
		</if>
		<if test="TimeRuleId !=null and TimeRuleId !='' ">
			and TimeRuleId like '%${TimeRuleId}%'
		</if>
		<if test="TimeRuleName !=null and TimeRuleName !='' ">
			and TimeRuleName like '%${TimeRuleName}%'
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 查询计时消费总数 -->
	<select id="selectTimeRuleTotal" parameterType="Map" resultType="Integer">
		SELECT count(TimeRuleInnerId) FROM Consumption_TimeRule where DelFlag=0
		<if test="TimeRuleInnerId !=null">
			and TimeRuleInnerId = #{TimeRuleInnerId}
		</if>
		<if test="TimeRuleId !=null and TimeRuleId !='' ">
			and TimeRuleId like '%${TimeRuleId}%'
		</if>
		<if test="TimeRuleName !=null and TimeRuleName !='' ">
			and TimeRuleName like '%${TimeRuleName}%'
		</if>
	</select>

	<!-- 新增计时消费 -->
	<insert id="insertTimeRule" parameterType="TimeRule" useGeneratedKeys="true" keyProperty="TimeRuleInnerId">
		INSERT INTO Consumption_TimeRule
		(
		<include refid="TimeRuleSqlNoId" />
		)
		VALUES
		(#{TimeRuleId},#{TimeRuleName},#{MerchantInnerId},#{Minutes},#{Money},#{Intpart},#{Timeout},#{MinMoney},#{Freetime},0,#{Remark},#{StandbyA},#{StandbyB},#{StandbyC},#{StandbyD})
	</insert>

	<!-- 修改计时消费 -->
	<update id="updateTimeRule" parameterType="TimeRule">
		UPDATE Consumption_TimeRule SET
		TimeRuleId = #{TimeRuleId},
		TimeRuleName = #{TimeRuleName},
		MerchantInnerId = #{MerchantInnerId},
		Minutes = #{Minutes},
		Money = #{Money},
		Intpart = #{Intpart},
		Timeout = #{Timeout},
		MinMoney = #{MinMoney},
		Freetime = #{Freetime},
		Remark = #{Remark},
		StandbyA = #{StandbyA},
		StandbyB = #{StandbyB},
		StandbyC = #{StandbyC},
		StandbyD = #{StandbyD}
		WHERE TimeRuleInnerId = #{TimeRuleInnerId}
	</update>

	<!-- 查询计时消费总数 -->
	<select id="selectConDeviceNums" resultType="Integer">
		SELECT count(ConTerminalInnerId) FROM Consumption_Terminal where DelFlag=0
	</select>
	
	<!-- 查询计时消费总数 -->
	<select id="selectMaxConDeviceNums" resultType="Integer">
		SELECT MaxConDeviceNums FROM System_Maximumlimit 
	</select>

	<!-- 查询菜品类型 -->
	<select id="selectMenuType" parameterType="Map" resultType="MenuType">
		SELECT TOP ${rows}
		<include refid="MenuTypeSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="MenuTypeSql" />
		FROM TCY_MenuType
		where DelFlag=0 
		<if test="FMenuTypeInnerId !=null">
			and FMenuTypeInnerId = #{FMenuTypeInnerId}
		</if>
		<if test="FMenuTypeId !=null and FMenuTypeId !='' ">
			and FMenuTypeId like '%${FMenuTypeId}%'
		</if>
		<if test="FMenuTypeName !=null and FMenuTypeName !='' ">
			and FMenuTypeName like '%${FMenuTypeName}%'
		</if>
		<if test="FRemark !=null and FRemark !='' ">
			and FRemark like '%${FRemark}%'
		</if>
		<if test="merchantList !=null and merchantList !='' ">
			and FMerchantInnerId in (select str2table from StrToTable(#{merchantList}))
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>
	
	<!-- 查询菜品类型 -->
	<select id="selectMenuTypeTotal" parameterType="Map" resultType="Integer">
		SELECT COUNT(FMenuTypeInnerId)
		FROM TCY_MenuType
		where DelFlag=0 
		<if test="FMenuTypeInnerId !=null">
			and FMenuTypeInnerId = #{FMenuTypeInnerId}
		</if>
		<if test="FMenuTypeId !=null and FMenuTypeId !='' ">
			and FMenuTypeId like '%${FMenuTypeId}%'
		</if>
        <if test="FMenuTypeName !=null and FMenuTypeName !='' ">
			and FMenuTypeName like '%${FMenuTypeName}%'
		</if>
		<if test="FRemark !=null and FRemark !='' ">
			and FRemark like '%${FRemark}%'
		</if>
		<if test="merchantList !=null and merchantList !='' ">
			and FMerchantInnerId in (select str2table from StrToTable(#{merchantList}))
		</if>
	</select>
	
	<!-- 查询菜单类型 -->
	<select id="selectMenuList" parameterType="Map" resultType="MenuList">
		SELECT TOP ${rows}
		<include refid="MenuListSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="MenuListSql" />
		FROM TCY_MenuList
		where DelFlag=0
		<if test="FMenuInnerId !=null">
			and FMenuInnerId = #{FMenuInnerId}
		</if>
		<if test="FMenuId !=null and FMenuId !='' ">
			and FMenuId like '%${FMenuId}%'
		</if>
		<if test="FMenuName !=null and FMenuName !='' ">
			and FMenuName like '%${FMenuName}%'
		</if>
		<if test="FMenuTypeInnerId !=null and FMenuTypeInnerId !='' ">
			and FMenuTypeInnerId in (select str2table from StrToTable(#{FMenuTypeInnerId}))
		</if>
		<if test="FRemark !=null and FRemark !='' ">
			and FRemark like '%${FRemark}%'
		</if>
		<if test="FStandbyA !=null and FStandbyA !='' ">
			and FStandbyA like '%${FStandbyA}%'
		</if>
		<if test="FStandbyB !=null and FStandbyB !='' ">
			and FStandbyB like '%${FStandbyB}%'
		</if>
		<if test="FEnableFlag !=null and FEnableFlag !='' ">
			and FEnableFlag in (select str2table from StrToTable(#{FEnableFlag}))
		</if>
		) as A
		WHERE RowNumber > ${start}
	</select>
	
	<!-- 查询菜单总数 -->
	<select id="selectMenuListTotal" parameterType="Map" resultType="Integer">
		SELECT count(FMenuInnerId)
		FROM TCY_MenuList
		where DelFlag=0
		<if test="FMenuInnerId !=null">
			and FMenuInnerId = #{FMenuInnerId}
		</if>
		<if test="FMenuName !=null and FMenuName !='' ">
			and FMenuName like '%${FMenuName}%'
		</if>
		<if test="FMenuTypeInnerId !=null and FMenuTypeInnerId !='' ">
			and FMenuTypeInnerId in (select str2table from StrToTable(#{FMenuTypeInnerId}))
		</if>
		<if test="FRemark !=null and FRemark !='' ">
			and FRemark like '%${FRemark}%'
		</if>
		<if test="FStandbyA !=null and FStandbyA !='' ">
			and FStandbyA like '%${FStandbyA}%'
		</if>
		<if test="FStandbyB !=null and FStandbyB !='' ">
			and FStandbyB like '%${FStandbyB}%'
		</if>
		<if test="FEnableFlag !=null and FEnableFlag !='' ">
			and FEnableFlag in (select str2table from StrToTable(#{FEnableFlag}))
		</if>
	</select>
	
	<!-- 新增菜单-->
	<insert id="insertMenuList" parameterType="Map">
		INSERT INTO TCY_MenuList
		(
		<include refid="MenuListSqlNoId" />
		)
		VALUES
		(#{FMenuTypeInnerId},#{FMenuPrice},#{FEnableFlag},0,#{FMenuId},#{FMenuName},#{FRemark},#{FStandbyA},#{FStandbyB},#{FStandbyC},#{FStandbyD})
	</insert>
	
	<!-- 查询菜单类型 -->
	<select id="selectConsumptionOper" parameterType="Integer" resultType="String">
		SELECT MerchantList
		FROM Consumption_OperatorPer
		where OperatorInnerId = #{operatorInnerId}
	</select>
	
	<!-- 修改菜单 -->
	<update id="updateMenuList" parameterType="Map">
		UPDATE TCY_MenuList SET
		FMenuId = #{FMenuId},
		FMenuName = #{FMenuName},
		FMenuTypeInnerId = #{FMenuTypeInnerId},
		FMenuPrice = #{FMenuPrice},
		FRemark = #{FRemark},
		FEnableFlag = #{FEnableFlag},
		FStandbyA = #{FStandbyA},
		FStandbyB = #{FStandbyB}
		WHERE FMenuInnerId = #{FMenuInnerId}
	</update>
	
	<!-- 查询菜单类型 -->
	<select id="selectFMenuTypeNameByMenuTypeInnerId" parameterType="Integer" resultType="MenuType">
		SELECT <include refid="MenuTypeSql"></include>
		FROM TCY_MenuType
		where FMenuTypeInnerId = #{fMenuTypeInnerId} 
	</select>
	
	<!-- 查询菜单类型 -->
	<select id="selectMenuListbyInnerId" parameterType="Integer" resultType="MenuList">
		SELECT <include refid="MenuListSql" />
		FROM TCY_MenuList
		where DelFlag=0 and FMenuInnerId = #{innerId}
	</select>
	

	<!-- 查询餐次价格 -->
	<select id="selectMealPrice" parameterType="Map" resultType="MealPrice">
		SELECT TOP ${rows}
		<include refid="MealPriceSql" />
		FROM (SELECT ROW_NUMBER() OVER (ORDER BY ${sort}
		${order}) AS RowNumber,
		<include refid="MealPriceSql" />
		FROM Consumption_MealPrice
		where DelFlag=0
		) as A
		WHERE RowNumber > ${start}
	</select>

	<!-- 验证餐次价格 -->
	<select id="verifyMealPrice" parameterType="Map" resultType="Integer">
		SELECT
		count(MealPriceInnerId)
		FROM Consumption_MealPrice
		where #{UserTypeInnerId} in (select str2table from StrToTable(UserTypeList))
		and #{MerchantInnerId} in (select str2table from StrToTable(MerchantList))
		and #{MealPriceInnerId} != MealPriceInnerId and DelFlag=0
	</select>

	<!-- 查询餐次价格总数 -->
	<select id="selectMealPriceTotal" parameterType="Map" resultType="Integer">
		SELECT count(MealPriceInnerId) FROM Consumption_MealPrice where DelFlag=0
	</select>

	<!-- 新增餐次价格 -->
	<insert id="insertMealPrice" parameterType="MealPrice">
		INSERT INTO Consumption_MealPrice
		(
		<include refid="MealPriceSqlNoId" />
		)
		VALUES
		(#{UserTypeList},#{MerchantList},#{BreakfastFirst},#{BreakfastNext},#{LunchFirst},#{LunchNext},#{DinnerFirst},#{DinnerNext},#{NightFirst},#{NightNext},0,#{Remark},#{StandbyA},#{StandbyB},#{StandbyC},#{StandbyD},#{BreakfastNums},#{LunchNums},#{DinnerNums},#{NightNums})
	</insert>

	<!-- 删除餐次价格 -->
	<update id="deleteMealPrice" parameterType="MealPrice">
		UPDATE Consumption_MealPrice SET
		DelFlag = 1
		WHERE MealPriceInnerId = #{MealPriceInnerId}
	</update>

	<!-- 修改餐次价格 -->
	<update id="updateMealPrice" parameterType="MealPrice">
		UPDATE Consumption_MealPrice SET
		UserTypeList = #{UserTypeList},
		MerchantList = #{MerchantList},
		BreakfastFirst = #{BreakfastFirst},
		BreakfastNext = #{BreakfastNext},
		LunchFirst = #{LunchFirst},
		LunchNext = #{LunchNext},
		DinnerFirst = #{DinnerFirst},
		DinnerNext = #{DinnerNext},
		NightFirst = #{NightFirst},
		NightNext = #{NightNext},
		Remark = #{Remark},
		NightNums = #{NightNums},
		DinnerNums = #{DinnerNums},
		LunchNums = #{LunchNums},
		BreakfastNums = #{BreakfastNums},
		StandbyA = #{StandbyA},
		StandbyB = #{StandbyB},
		StandbyC = #{StandbyC},
		StandbyD = #{StandbyD}
		WHERE MealPriceInnerId = #{MealPriceInnerId}
	</update>
	
	<insert id="insertMenuType" parameterType="Map">
		insert into TCY_MenuType(
			<include refid="MenuTypeSqlNoId"></include>
		)values(#{FMenuTypeId},#{FMenuTypeName},0,#{FRemark},#{FStandbyA},#{FStandbyB},#{FStandbyC},#{FStandbyD},#{FMerchantInnerId},#{FEnableFlag})
	</insert>
	
	<!-- 修改餐次价格 -->
	<update id="updateMenuType" parameterType="Map">
		UPDATE TCY_MenuType SET
		FMenuTypeId = #{FMenuTypeId},
		FMenuTypeName = #{FMenuTypeName},
		FRemark = #{FRemark},
		FMerchantInnerId = #{FMerchantInnerId},
		FEnableFlag = #{FEnableFlag}
		WHERE FMenuTypeInnerId = #{FMenuTypeInnerId}
	</update>
	
	<select id="selectMenuTypeNumsByFMerchantInnerId" parameterType="Integer" resultType="Integer">
		select count(FMenuTypeInnerId) from TCY_MenuType where FMerchantInnerId = #{FMerchantInnerId} and DelFlag = 0 and FEnableFlag = 0
	</select>
	
	<select id="selectPeopleTotal" resultType="Integer">
		select count(UserInnerId) from System_UserInfo where DelFlag = 0
	</select>
	
	<select id="selectMoneyTotal" parameterType="Integer" resultType="Integer">
		select sum(Money) from System_Account where AccountTypeInnerId = #{AccountTypeInnerId}
	</select>
	
	<select id="selectTerminalByConTypeInnerId" parameterType="Integer" resultType="Integer">
		select count(ConTerminalInnerId) from Consumption_Terminal where #{conTypeInnerId} in (select str2table from StrToTable(ConTypeList))
	</select>
	
	<!-- 查询符合条件的菜品 -->
	<select id="selectMenus" parameterType="Map" resultType="Menus">
		select <include refid="menusSql"/> from View_Menus
		where MerchantName = #{MerchantName} and DelFlag = 0 and Del = 0 
		and FMenuTypeName = #{FMenuTypeName} and FMenuPrice = #{FMenuPrice} and FMenuName = #{FMenuName}
	</select>
	
	<!-- 根据商户名称查询商户信息 -->
	<select id="selectMerchantByMerchantName" parameterType="Map" resultType="Merchant">
		select <include refid="MerchantSql"></include> from Consumption_Merchant
		where MerchantName = #{MerchantName} and DelFlag = 0
	</select>
	
	<!-- 根据条件查询是否存在菜类 -->
	<select id="selectMenuTypeByMenuTypeName" parameterType="Map" resultType="MenuType">
		select top 1 <include refid="MenuTypeSql"></include> from TCY_MenuType
		where FMenuTypeName = #{FMenuTypeName} and FMerchantInnerId = #{FMerchantInnerId}
		and DelFlag = 0
	</select>
	
	<insert id="insertInvoiceLog" parameterType="InvoiceLog" useGeneratedKeys="true" keyProperty="InvoiceLogInnerId">
		insert into System_InvoiceLog (OperInnerId,Money,OperDT,ConLog) values 
		(#{OperInnerId},#{Money},#{OperDT},#{ConLog})
	</insert>
	
	<update id="updateConLogforInvoiceLog" parameterType="Map">
		update Consumption_Conlog_Discount set 
		StandbyC = #{StandbyC},
		StandbyB = 1
		where ConLogInnerId = #{ConLogInnerId}
	</update>
	
	<!-- 根据商户主键查询设备主键 -->
	<select id="selectTerminalByMerchantList" parameterType="String" resultType="Integer">
		select ConTerminalInnerId from Consumption_Terminal where 
		MerchantInnerId in (select str2table from StrToTable(#{merchantList}))
	</select>
	
	<!-- 统计菜品 -->
	<select id="selectConMenuStatistics" parameterType="Map" resultType="MenuStatistics">
		select FMenuName as MenuName,SUM(Number) as Number from View_ConMenu where 1 = 1
		<if test="ConTerminalInnerId != null  and ConTerminalInnerId != '' ">
			and ConTerminalInnerId in (select str2table from StrToTable(#{ConTerminalInnerId}))
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'UploadDatetime'">
			and UploadDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		<if test="TimeType !=null and TimeType !='' and TimeType == 'ConDatetime'">
			and ConDatetime between cast(#{StartTime} as datetime) and cast(#{EndTime} as datetime)
		</if>
		group by MenuName,FMenuName
	</select>
</mapper>